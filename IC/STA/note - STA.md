---
dateCreated: 2025-02-27
dateModified: 2025-04-09
---
# STA 静态时序分析
### Setup Hold
- **建立时间**（setup time）是指在触发器的时钟信号有效沿到来以前，数据稳定不变的时间
- **保持时间**（hold time）是指在触发器的时钟信号有效沿到来以后，数据稳定不变的时间
- 建立时间决定了该触发器之间的组合逻辑的*最大*延迟。保持时间决定了该触发器之间的组合逻辑的*最小*延迟

![img](pics/setup_time.png)

$建立时间容限＝T_{clk}-T_{ffpd}(max)-T_{comb}(max)-T_{setup}$

$T_{setup}≤T_{clk}-T_{ffpd}(max)-T_{comb}(max)$

![img](../jobinterview/pics/hold_time.png)

$保持时间容限+T_{hold}＝T_{ffpd}(min)+T_{comb}(min)$

$T_{hold}≤T_{ffpd}(min)+T_{comb}(min)$

**总结**
无 skew：
$T>Tco+Tlogic+Tsu$
$Thold<Tco+Tlogic$
有 skew：
$T>Tco+Tlogic+Tsu-Tskew$
$Thold<Tco+Tlogic-Tskew$

# 时序约束出现时序违例 (Slack 为负数)，如何处理？

答：

一. 首先指出一个误区：当约束出现错误时，想当然地认为是“时序约束做得不对”，所以应该怎么去改“时序约束”，从而让这些错误消失，这是一个错误的观念。

二. 时序约束的作用：在于检查“设计是否满足时序要求”，它是用来审视自己设计的，很多情况是，要改设计代码来满足时序要求。

三. 当时序约束提示有错误时，应该阅读“时序报告”，从报告中分析时序路径（数据到达时间、时钟到达时间和数据要求时间等），根据报告分析错误的原因，并根据原因来实行不同的方法。

以建立时间违例，说明具体方法如下：

1. 时序报告中，找到提示错误的路径，即目的寄存器，以及源寄存器。注意，这是两个寄存器的点。
2. 首先判断，源寄存器的时钟，与目的寄存器的时钟，是否相同。如果不同，可以认为是异步时序，见步骤 3；如果是相同，则看步骤 4。
3. 如果是异步电路，那么处理方法如下：

A. 确认做了异步处理。对于数据，则是通过异步 FIFO 来做异步处理；如果是控制信号，则要经过打两拍来处理。

B. 确认做了异步处理后，仍然会报“时序违例”的。这个时候，可以该路径设置成 set false path，不用再检查。

1. 同步电路下，具体处理如下：

A. 查看两个寄存器点之间，经过了多少加法器、乘法器、除法器等。

B. 对于除法器，要特别留意，一般是 1 个时钟计算不完的。那么可以 a.想办法不用除法；b. 通过使能信号控制获取除法器结果的时间。

C. 对于乘法器和加法器，或者其他组合电路较多的。想办法分隔成流水线来实现。可以参考 MDY 流水线的内容。

1. 如果是 IP 核的违例，检查是否时钟不满足 IP 核的要求。如果没问题，就不用管。
2. 如果是 ILA 等在线调试工具路线的违例，则一般不用处理。
3. 如果是线延时太长的，可以尝试打一拍处理。即 A->B 的线太长，可以打一拍，变成 A->C->B，这样线延时就小了。

# 参考

从 CMOS 到建立时间和保持时间

https://zhuanlan.zhihu.com/p/120863919

包括复位、时钟域多个概念

产生 setup hold 的原因

两篇总结的很好的时序约束的文章：[八小时超长视频教你掌握FPGA时序约束！](https://mp.weixin.qq.com/s/V3qCQNCcxpO_PaWso3GWkw)

结合上面一文整理的时序约束笔记: 时序约束整理. md

[FPGA时序分析—vivado篇](https://mp.weixin.qq.com/s/gkXRNblISyUIIrIxLRmLgw)

[时序约束策略](https://mp.weixin.qq.com/s/dmJck_7vDd57JFvAL3dFpg)
