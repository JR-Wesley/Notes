# 微处理器设计：架构、电路及实现

虞志益 曾晓洋 魏少军

## 1. 设计概论

Von Neumann结构，

IC工艺与器件、处理器设计和IC设计、软件技术。目前已突破7nm：copper铜互连、应变硅strained Si、高K金属栅hi-K metal gate；FinFET；阈值电压调整Vt tuning。关键处理器技术包括：

1. 流水线。使得CPI达到1
2. 超标量super scalar指令并行，一周期获得多指令同时执行。硬件运行时动态判定获取指令，以及超长指令字VLIW，利用编译器在运行前静态判定可并行获取和执行的指令。
3. 单指令多周期(SIMD)，用于图像、多媒体。类似的有矢量处理器。
4. 缓存cache：利用时间、空间局部性，把关键、频繁访问的指令数据放在cache中，缓存用SRAM实现，内存用DRAM实现。
5. RISC：相对少的指令类型、简单的指令格式、简单的寻址方式，提高功耗、简化编译器。
6. 多核：功耗挑战，
7. IC设计自动化
8. 动态电压频率调整（DVFS）：低功耗技术，负载低时降低电压和时钟频率；负载升高则升高。

时钟频率及性能不断提升，但出现了功耗的制约；存储容量不断提高但存储访问速度严重；多核；数据位宽增长；应用领域丰富。

RISC：

1. 选用频率较高的指令和必要的指令，摒弃使用频率低且不必要的指令。
2. 每条指令尽量简单，一个机器周期完成。
3. 指令长度相同
4. 只用load/store指令才能访问存储器。

指令集并行技术超长指令字-应用于DSP等特殊领域

超标量处理器：存在大量缓冲。

1. 使用硬件动态判定可以并行的指令，同时执行多条指令、构成多条并行流水线使CPI小于1
2. 不同类型指令进入不同流水线，每条流水线都有特殊性。
3. 内部采用乱序执行，避免停顿
4. 采用预测的方法降低流水线的停顿。

## 2. 存储架构及电路

1. 存储结构与局部性

缓存与内存的映射包括：直接映射、全相连、N路组互连

虚拟内存：CPU程序输出的读写地址为虚拟地址，地址通过内存管理单元MMU转换成物理地址。

作用：突破内存容量，内存DRAM相当于存储空间的缓存；简化存储管理、每个进程均可得到相同的地址空间、高效的多进程管理、有效隔离各进程之间的地址空间。

2. 存储电路

SRAM：六管、八管、多端口

DRAM：一个晶体管

## 3. 多核及众核

可以协调多个核心并行计算；可以采用灵活的时钟频率核电源电压管理；分布式结构可以解决全局连线的挑战

核间通信：

共享存储-不同核各有cache，物理共享memory

消息传递-存储分离，通过点对点通信

- 共享存储的缓存一致性问题：每个处理器对私有的缓存写数据影响共享存储及其他处理器私有存储的有效性-》基于监听、目录的方法。

片上网络：涉及拓扑结构、路由、仲裁、交换。

## 4. 微处理器扩展



## 6. 微处理器设计流程

工艺选择(TSMC/SMIC/GlobalFoundry)、架构设计、HDL设计仿真、逻辑综合、版图设计规划

DRC/LVD采用mentor的calibre，STA核形式验证采用Synopsys的PrimeTime核formality

早期处理器企业核集成电路企业同时进行设计和制造，称为IDM；TSMC专注于IC制造代工foundry，专注于设计称为fabless，如高通/ARM/NVIDIA

硬件验证常用system verilog，验证也有许多方法学如Synopsys的VMM和Accellera的UVM

