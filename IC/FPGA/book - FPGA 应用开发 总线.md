---
dateCreated: 2025-04-09
dateModified: 2025-04-09
---
# IO 规范与外部总线

## 信号线 TODO
### 高速串行接口

并行接口在传输高速信号时容易产生串扰，即相邻的导线因电场耦合而相互干扰。另外对于板间连接，接插件和导线增多会指数级地降低可靠性，因而**高速数据传输常采用串行，电平也常用差分规范**，如 LVDS。LVDS 等真差分规范多用在串行传输，很少用纯粹并行。高速串行传输中，将并行数据转换为串行数据的过程称为串行化，相反的过程称为解串行化，相应的功能单元或器件称为串行器和解串行器，合称**串行解串器（Serializer/Deserilizer, SerDes）**。

高速数据在传输时，往往还需要**同步传输时钟**，因为如果不同步传输时钟而是在 PCB 上另行走线分配时钟，些许线长差异将造成高频时钟在源端和末端出现明显的相位差（称为时钟偏斜），导致时序困难。

图示为高速串行传输过程，PLL 锁相环用于时钟频率和相位变换。其中的位时钟，一般为数据率的一般，即在时钟上升沿和下降沿各同步一次数据，称为 DDR（双倍数据率），使用 DDR 能增加时钟的上升沿/下降沿时间以改善信号完整性。位时钟通常不传输（因为位时钟并不包含帧同步信息），而之传输帧时钟，之后再接收端由锁相环倍频恢复位时钟。移位寄存器是最简单的串行器和解串行器，解串时需要上升沿和下降沿均有效，实际的 SerDes 也常用数据选择器和分配器实现。

![](assets/总线/高速串行传输示意.png)

对于并行数据率 $f_{DATA}$，一帧 $N$ 位地串行 DDR 数据，串行数据率 $f_{SDATA}=N\cdot f_{DATA}$，帧时钟频率 $f_{FCLK}=F_{DATA}$，位时钟频率 $f_{BCLK}=N/2\cdot f_{DATA}$。时钟的传输还可以嵌入数据之中，这样使用一对差分线即可完成数据同步传输。嵌入时钟地串行传输需要使用特定的编码才能实现，而且会稍微增加数据量。最常用的编码是 8 b/10 b 编码，它将每个字节编码为 10 位，它还可以保证编码没有直流分量，便于接收端判决电平。8 b/10 b 编码广泛用于各种高速串行传输场合，如 USB 3.0/SATA/PCI Express/qian 千兆以太网/DVI/HDMI/DisplayPort，此外还有 64 b/66 b, 128 b /130 b, 128 b/132 b 编码，用于更高速的 10 G 以太网/PCIE 3.0/USB 3.1 中

![](assets/总线/嵌入时钟地高速传输.png)

大多数 FPGA 的 IO 口均支持 LVDS 高速串行传输，其中要用到的 SerDes 在开发工具中均会提供。嵌入时钟的高速数据传输单元常称为高速收发器 Gigabit Transceiver，一般由固化的硬件实现，只在中高端 FPGA 中提供。

## UART

## SPI

## I2C

## I2S

# 片上互联

对于 FPGA，微处理器可以是固化在内部的处理器，称为“硬核”，也可以是使用 FPGA 通用逻辑单元设计组合而成的“软核”。带有硬核的 FPGA 可以理解为在一块晶片上或一个芯片封装里。而软核本身只是存在于工具库里的一个设计，在 FPGA 芯片上本不存在，在用户工程中需要一个处理器时再实例化它，然后编译配置到 FPGA 中。软核占用 FPGA 的逻辑资源，性能较硬核弱，但使用灵活。无论硬核还是软核，处理器与外设、外设与外设甚至多个处理器之间都需要数据互连。

AXI4 和 AXI4-Lite 属于存储器映射 (Memory Map) 接口，用于主从结构的多地址互连，区分主接口 (Master) 和从接口 (Slave)；而 AXI4-Stream 属于流式 (Stream) 接口，用于流式数据传输，区分源接口 (Source) 和汇接口 (Sink)。

## 简单存储器映射

本节介绍一个简单的存储器映射接口 (以下简称 MM 接口) 这个简单的 MM 接口不包含握手机制，也不支持多主机互连——支持多主机需引入握手、仲裁甚至服务质量管控机制。

## 流水线

## 握手

“valid” 和“ready”握手机制——AXI 总线使用的机制。

valid 信号由主接口或源接口产生，ready 信号则由从接口或汇接口产生，一般定义为高电平有效。

在 valid-ready 握手机制中

- valid 为“数据有效”之意，一旦数据有效便置位，然后持续到握手成功才可能会清除。
- ready 为“可以接收”之意，具备接收数据的条件时置位。
- valid 和 ready 同时置位，则两者传递一次数据（在即将到来的时钟有效沿）称为一次握手。
- 握手后如果下一个周期数据仍是有效数据，valid 可继续置位，否则应清除。
- 握手后如果下一个周期仍然可以接收数据，ready 可继续置位，否则应清除。
- valid 置位不得依赖于 ready 的状态，任何时刻数据有效，valid 应被置位，而不能等待 ready。
- ready 置位可依赖于 valid 的状态，接收端可以等待 valid 置位后置位 ready。
- valid 清除依赖于 ready 的状态，valid 清除只能发生在握手成功之后，以确保有效数据被接收。
- ready 清除不依赖于 valid 的状态，任何时候不具备接收数据的条件，ready 可被清除。

## AXI

# 数字通信应用
# DDR3

# PCIE
