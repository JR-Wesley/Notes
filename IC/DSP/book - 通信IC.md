![[../commFig/Pasted image 20240404145814.png]]# ch1 IC设计与HDL

# ch2 FPGA 设计

# ch3 通信系统基本部件
各种基本单元实现，反复运用四种经典手段：重定时、折叠、展开、脉动阵列。
## 3.1 通信模型架构
通信电路设计存在三个层次：1. 基本单元如乘加；2. 单一运算单元如FFT；3. 基本通信模块如同步均衡滤波。
![[../commFig/Pasted image 20240404145829.png]]
![[../commFig/Pasted image 20240404145919.png]]

## 3.2 通信系统基本算法
完整的通信基带系统可以归纳为：频谱搬移、转换频域、转换时域、星座映射。接收处理过程为Off load过程，包括：高速率变换低速率、并转串、冗余去除；发送则相反。内核算法需要调制和接收的辅助变换，也需要各种包装。
对于上述通信模块逐层分解的归纳总结如下（逐层分解物理层的算法）。
- 同步的原理：匹配滤波、相关运算。 
- 频偏的原理：匹配滤波、反正切或反余弦运算。
- 相偏的原理：相关运算。
- 定时偏差的原理：Gardner环路、符号运算、比较大小、插值运算。
- 均衡的原理：求模与相关运算、矩阵求逆。
- 频偏补偿的原理：相位旋转，等效于复数乘法与正余弦。
- 导频的原理：相位与幅度的拟合，等效于插值。
- 时域频域变换：FFT。
- MIMO的原理：矩阵乘法与求逆，等效于循环乘法与高精度除法运算。
![[../commFig/Pasted image 20240404151144.png]]
![[../commFig/Pasted image 20240404151202.png]]
表中算法可以分为几类：
1. 向量运算
FIR、IIR、匹配滤波等都可以归纳为标准内积实现。抽象得说向量计算就是两个空间之间的举例，纠错编码计算实质也是（即空间范数）。
2. 矩阵变换
FFT、DCT、DWT等算法本质都属于矩阵变换的最优实现方法。这类算法通常通过一系列矩阵变换，对输入输出数据完成正交化处理，可认为是一种空间映射，分为分段映射或逐步一ing设，其最优处理方法与Viterbi、CORDIC思想类似。常用的奇异值分解算法也是按照分布计算思想设计。
3. 函数计算
包括各类三角、超越、无穷展开的计算，可以通过查表、有限字长逼近等实现
4. 数据集合映射变换
包含数据的抽取、插值、频点搬移等，可以归纳为按照一定规则对有限数据集合进行映射变换。
![[../commFig/Pasted image 20240404153838.png]]
## 3.3 通信IC设计基本套路
根据芯片类型和架构设计，分类，围绕芯片速率类型对应设计。

## 3.4 数字滤波器设计
根据冲激响应的时域特征，可以将数字滤波器分为两类：infinite Impulse Response, Finite Impulse Response。FIR保证输入输出相位线性变化，IIR会引起变化。相位变化会导致数据发送前后时间一致性发生变化（群延时畸变）。

### FIR
![[../commFig/Pasted image 20240404164615.png]]
FIR滤波器指标![[滤波器指标.png|DSP/滤波器指标.png]]
时域表达式：
$$
y(n) = \sum^{L-1}_{i=0}h(n)x(n-i)
$$
$x(n)$是采样输入信号序列，$y(n)$是输出信号序列，$h(n)$称为Coefficients，滤波器长度为L。稀疏长度越大，硬件复杂度越高，输入延迟越大，有效位数越低，资源越少。
转化为z变换，$z^{-1}$表示单位延迟，等效一个寄存器所存：
$$
y(z) = \sum^{N-1}_{n=0}h(z)z^{-n}= z^{1-N}\sum^{N-1}_{n=0}h(z)z^{N-n-1}
$$
![[../commFig/Pasted image 20240404172732.png]]
因此，直接结构N阶FIR滤波器需要N级数据一位寄存器、N个乘法器、N-1个加法器。
![[Pasted image 20240404173145.png]]
转置型，不直接缓存输入数据，使得数据通道频率提升。但是缓存的数据位宽增加了，不过可以进行截短处理。

#### 直接型结构 (Direct Form Structure)
**优点**：
- 适合实现采样数据和系数的有效位数（位宽）都较短且阶数较大的FIR滤波器，不适用如12、16位输入滤波器，因为需要大量移位寄存器。
- 通常具有较低的资源消耗，因为不需要额外的模块化设计来处理较大的位宽。

**缺点**：
- 不适合实现采样位宽较大的FIR滤波器（例如12位或16位输入），因为这需要大量的移位寄存器。
- 可能存在资源浪费，因为滤波器内部的精度为全精度，而在实际使用中可能不需要这么高的精度。

#### 转置结构 (Transposed Structure)
**优点**：
- 抽头模块的级联特性使得器件之间的互连容易实现。通过流水线结构可以缩减从输入到输出的延时。

**缺点**：
- 加法器的位宽逐渐增加，这使得模块化设计变得困难，并且在采样数据和系数位宽都较短而阶数很大时，会导致资源的浪费。
- 适合采样数据和系数位宽都较大且阶数较小的FIR滤波器，不适合位宽较短而阶数很大的FIR滤波器。

#### 适用场景和设计考虑
- 直接型结构更适合于低精度和高阶数的应用场景。
- 转置结构更适合于高精度和低阶数的应用场景。
- 在设计FIR滤波器时，需要考虑实际应用中的精度需求，进行截短。
- 应该利用FIR滤波器系数的对称特性来优化设计。
- 在实现更高阶的FIR滤波器时，需要考虑乘法器数量和累加器负担的增加，可能需要引入多级缓存来减轻负担。

综上所述，选择合适的FIR滤波器结构需要根据具体的应用需求、数据位宽、滤波器阶数以及资源限制等因素来综合考虑。设计者应该灵活运用各种设计方法和优化策略，以达到最佳的性能和资源利用率。
### FIR硬件结构实现
本质是对输入的一段数据的乘加运算，因此约束可以简化为：给定M个周期一个数据输入、N个周期一个数据输出。设计FIR滤波器时，主要围绕以下三个核心主题进行：
1. **FIR滤波器的数据输入形式**：
   - 初始化：确定滤波器开始处理数据前，如何设置或加载初始状态。
   - 流水与否：决定数据处理是顺序执行还是并行执行，以及是否支持流水线操作以提高效率。
   - 中断后重新输入：当处理过程因某些原因中断时，如何恢复并重新输入数据。
   - 复位处理：在滤波器需要重置到初始状态时，应如何处理。
2. **FIR滤波器的系数装载方式**：
   - 初始化：确定滤波器系数在开始使用前的加载方式。
   - 能否变更：滤波器系数是否支持在运行时动态变更。
   - 变更形式：如果支持动态变更，需要确定变更的方式和频率。
3. **FIR的乘加结构实现**：
   - 乘法器数量：根据滤波器的设计确定所需的乘法器数量。
   - 乘法结果保存位置：决定乘法结果存储的位置，这可能影响数据处理的效率和资源使用。
   - 系数的简化与合并：为了减少资源消耗和提高性能，考虑对系数进行简化和合并。
   - 是否采用DA算法：决定是否使用Distributed Arithmetic（DA）算法来优化乘法操作。
基于上述三个主题的组合，FIR滤波器的硬件结构可以形成多个分支：
- **基于累加器结构的FIR滤波器**：
  - 串行乘累加FIR滤波器结构：适合资源受限的环境，可以支持部分折叠以优化性能。
  - 并行乘法器直接型FIR滤波器结构：适用于需要高吞吐量的场合。
  - 并行乘法器转置型FIR滤波器结构：通过转置结构优化资源使用和性能。
  - 脉动型（Systolic）FIR滤波器结构：一种高效的并行处理结构，适合于实时信号处理。
  - 半并行（Semi-Parallel）FIR滤波器结构：结合了串行和并行的优点，提高了性能和灵活性。
- **基于分布式算法的FIR滤波器**：
  - 串行分布式FIR滤波器：通过串行处理实现分布式算法。
  - 并行分布式FIR滤波器：利用并行处理提高性能。
  - 串并结合分布式FIR滤波器：结合串行和并行处理的优势，提供更高的灵活性和性能。



### IIR滤波器

## 3.5 FFT
DFT是FT在离散系统的表现形式，FFT将DFT$O(N^2)$运算复杂度降低到$O(Nlog_2 N/2)$次运算。物理意义是利用一组正交的正弦/余弦逼近任意函数，而正余弦拥有曲线保真性。后续发展的DCT、DWT、FWT都是类似正交基逼近。某种意义上，FFT也可以认为是特殊的FIR，IFFT也和FFT类似。
对OFDM而言，IFFT应理解为波形发生器，以输入数据块内容为参数，产生响应波形，IFFT/FFT不是对信号变换，而是对承载了信号的载波变换，待传输的数据就是被承载的波形。
![[../commFig/Pasted image 20240406112057.png]]
#### 算法概述
当序列$f[n]$的点数不超过N时，它的N点DFT定义为：
$$\begin{array}
FF[k] = \sum^{N-1}_{n=0}f[n]e^{-j2\pi/Nkn}, 0\le k<N-1\\
f[n] = \frac 1 N sum^{N-1}_{n=0}F[k]e^{j2\pi/Nkn}, 0\le n<N-1
\end{array}
$$
令$W_N=e^{-j2\pi /N}$，可知直接计算，每行含有N个复数乘和加，总计算量为$N^2$个复数乘和加。计算量增大同时有限字长导致累加误差导致结果不收敛。
- 算法特点：
对称性：$(W_N^{nk})^*=W_N^{-nk}=W_N^{Nn-nk}=W_N^{Nk-nk}$
周期性：$W_N^{nk} = W_N^{nk+nN}=W_{N}^{nk+kN}$
可约性：$W_N^{nk}=W_{N/m}^{nk/m}$
特殊性：$W_N^0=1, W_N^{N/2}=-1,  W_N^{k+N/2}=- W_N^k$
可以理解$W_N^k$当作一个单位圆上的旋转向量，运用系数的性质来改善DFT运算效率。
![[Pasted image 20240409174236.png]]
如图进行二分之后，N点DFT运算量正比于$Nlog_2(N)$。根据拆解方式不同，可以分为频域抽取DIF和时域抽取DIT。
##### 基2频域抽取FFT
输入序列长度$N=2^M$，该序列按时间顺序的奇偶分解为子序列，称为基2时间抽取的FFT。若不满足可以加上若干零以补足到N。取$N=k^M$则称为基k算法。实际多采用基4或基8，LTE中也存在K为质数如基3。IC设计不采用基2是因为基2对中间结果存储消耗过大。
从DFT开始对FFT简化运算推导：
$$\begin{array}
WW_N^{kn}=e^{-j2\pi/N kn}\\
F[k] = \sum^{N-1}_{n=0}f[n]e^{-j2\pi/Nkn}, 0\le k<N-1\\
\end{array}
$$
按顺序分为两个部分，利用系数性质合并：
$$\begin{array}
F[k] = \sum^{N/2-1}_{n=0}f[n]W_N^{kn}+\sum^{N/2-1}_{n=0}f[n+N/2]W_N^{k(n+N/2)}, 0\le k<N-1\\
F[k] = \sum^{N/2-1}_{n=0}(f[n]+(-1)^kf[n+N/2])W_N^{kn}, 0\le k<N-1\\
\end{array}
$$

#### 面临的问题

#### 硬件实现方案


## 3.6 CORDIC




# ch4 通信信道编解码

