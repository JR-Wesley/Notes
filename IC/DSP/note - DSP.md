---
dateCreated: 2024-03-31
dateModified: 2025-02-27
---
# FFT

[数字芯片IP设计——FFT加速核设计（一） - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/401207432)

FFT 是数字信号处理中非常重要的一个组件。担负了时频域数据的转换。同时，FFT 中的数据通路也是数字芯片设计中较为典型的案例。

我们通过 FFT 的设计，学习如何实现算法的加速，以及熟悉数字电路数据通路 how to 抠成本。数据通路的设计是数字芯片设计中必须要过的一道关。FFT 非常典型，建议练习设计。

FFT 设计中主要有几个方面影响成本和性能。

![[Pasted image 20240331145033.png]]

主要包括了数据通路、存储架构、旋转因子三方面。本文主要设计数据通路的介绍。存储架构和旋转因子仅仅略讲。

## 1 FFT 基本原理

FFT 原理来源于傅里叶变换。

$$
\begin{array}
X[k] = \sum^{N-1}_{n=0}x[n] W^{nk}_N,k=0,1,...,N-1\\ W^{nk}_N = e^{-j\frac{2\pi}{N}nk}
\end{array}
$$

通过计算下面的蝶形图来得到结果。下图为 16 点 FFT 的结构图。

![[../Pasted image 20240331145132.png]]

## 2 数据通路

### 2.1 延迟反馈 DF 型 FFT 架构

我们首先从 Delay Feedback 类型的架构开始讲起。DF 的精髓在与将输出反馈回数据 buffer，实现数据的倒换。

**【SDF】**

下图是 SDF 的数据架构。

# 滤波器对比

相较于 IIR 滤波器, FIR 滤波器有以下的优点:

- 可以很容易地设计线性相位的滤波器. 线性相位滤波器延时输入信号, 却并不扭曲其相位.
- 适合于多采样率转换, 它包括抽取 (降低采样率), 插值 (增加采样率) 操作. 无论是抽取或者插值, 运用 FIR 滤波器可以省去一些计算, 提高计算效率. 相反, 如果使用 IIR 滤波器, 每个输出都要逐一计算, 不能省略, 即使输出要丢弃.
- 具有理想的数字特性. 在实际中，所有的 DSP 滤波器必须用有限精度（有限 bit 数目）实现，而在 IIR 滤波器中使用有限精度会产生很大的问题，由于采用的是反馈电路，因此 IIR 通常用非常少的 bit 实现，设计者就能解决更少的与非理想算术有关的问题。
- 可以用小数实现. 不像 IIR 滤波器，FIR 滤波器通常可能用小于 1 的系数来实现。（如果需要，FIR 滤波器的总的增益可以在输出调整）。当使用定点 DSP 的时候，这也是一个考虑因素，它能使得实现更加地简单。

相较于 IIR 滤波器, FIR 滤波器的缺点是什么?

- 相比较于 IIR 滤波器, 有时 FIR 滤波器为了得到一个给定的滤波响应特性,需要花费更多的存储器或者计算. 当然,用 FIR 滤波器去实现某些响应也是不实际的.

# FIR
- 冲激响应 - FIR 滤波器的冲激响应实际上是 FIR 的系数.
　　* 抽头 (Tap) - FIR 的抽头是系数或者延时对.FIR 抽头的个数 (通常用 N 来表示) 意味着:1) 实现滤波器所需要的存储空间, 2) 需要计算的数目, 3) 滤波器能滤掉的数量, 实际上,越多的抽头意味着有更多的阻带衰减, 更少的波纹,更窄的滤波等等.
　　* 跃迁带（Transition Band）- 在通带和阻带边沿之间的频带。跃迁带越窄，需要更多的抽头去实现滤波器。也有说，小的跃迁带就是一个 sharp 滤波器。
　　* 延时线 - 一组存储器单元，实现在 FIR 计算中的 Z^-1 延时。
　　* 环形缓存 - 一个特殊的缓存，是首尾相连的。通常由 DSP 微处理器实现。

## 线性相位

是指滤波器的相位响应是频率的线性函数（在 +/-180 度）。因此滤波器的延时后，所有的频率相位相同。因而滤波器不会产生相位和延迟扭曲。在某些领域，比如数字解调器，没有相位或者延迟扭曲是 FIR 滤波器相对于其他 IIR 和模拟滤波器的一个关键优点

FIR 滤波器经常被设计成为线性相位的，当然不是必须要这么做。如果滤波器的系数是关于中心系数对称的，也就是说第一个系数和最后一个系数相同，第二个系数和倒数第二个相同，那么 FIR 滤波器就是线性的。有奇数个系数的 FIR 滤波器，中心单独的系数没有对应的。

线性相位 FIR 滤波器的延时：给定 FIR 滤波器有 N 个抽头,那么延时是 (N - 1) / (2 * Fs), 这里 Fs 是采样频率. 比如, 21 抽头的线性相位滤波器运行在 1kHz, 那么延时就是 (21 - 1) / (2 * 1 kHz)=10 微秒.

 FIR 滤波器是固有稳定的，因为没有反馈，任何有限的输入产生有限的输出。

缺少反馈是关键。在计算机中实现 FIR 滤波器时，每个计算都产生数字错误。由于 FIR 滤波器没有反馈，因此不能够记住以前的错误。相反，IIR 滤波器的反馈可能导致错误的积累。这个实际的影响就是，可以用更少的 bit 去实现与 IIR 滤波器相同精度的滤波器。比如，FIR 滤波器通常用 16 位来实现的话，IIR 滤波器就通常需要 32 位，或者更多。

为什么通常在多采样率系统中采用 FIR 滤波器而不采用 IIR 滤波器

因为只有一小部分的计算需要用减采样或者插值滤波器来实现。由于 FIR 滤波器不使用反馈，因而只有那些实际需要使用的输出才需要计算。比如，在减采样的时候（N 个输出中只有一个有效），那么其他的 N-1 输出就不会进行计算。类似的，对于插值滤波器（在采样点中插入 0 来提高采样率），你不必实际地用 FIR 滤波器乘以系数，求和得到，你只需要忽略和这些值有关的乘加（因为它们不会改变结果）。相反，因为 IIR 滤波器使用反馈，每个输入都必须使用，每个输入必须计算，因为所有的输入和输出对滤波器的反馈都有影响。

# IIR

# CORDIC

复杂的函数计算方法通常包括：

1. ROM。精度不够，
2. 多项式近似
3. 查表、插值。23 在缺乏硬件乘法器和追求资源最优化的项目中难以被采用。
CORDIC 都是采用分而治之的方法，核心思想是：利用反复迭代逐次逼近理论、所有计算都是有限长计算，到达一定精度就终止。优势：不需要硬件乘法器，所有运算只有移位累加；可使用流水线方法

## 数字锁相环
