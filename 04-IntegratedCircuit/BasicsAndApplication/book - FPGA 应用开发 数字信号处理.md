---
dateCreated: 2024-12-24
dateModified: 2025-05-18
---
# 数字信号处理应用
## 基础
### LTI

数字域的信号就是时间离散、取值量化的数值序列。

LTI 是**线性时不变系统**。LTI $S\{\cdot\}$ 系统的**单位冲激响应**为输入单位冲激信号的响应：

$$
h[n] = S\{\delta [n]\}
$$

任何输入信号可以表示为无穷个单位冲激响应的加权平移之和，响应可以表示为单位冲激响应的加权和：

$$
\begin{align}
x[n]&=\sum_{k=-\infty}^{\infty}x[k]\delta[n-k]\\
S\{x[n]\}&=y[n]=\sum_{k=-\infty}^{\infty}x[k]h[n-k]
\end{align}
$$

这个求和过程又称**离散卷积**，定义为

$$
x[n]*h[n]\overset{\underset{\mathrm{def}}{}}{=}\sum_{k=-\infty}^{\infty}x[k]h[n-k]
$$

### Z 变换

定义变量 $z=re^{j\Omega}=r(cos\Omega + j sin\Omega)$，定义 **z 变换**：

$$
Z\{x[n]]\}\overset{\underset{\mathrm{def}}{}}{=}\sum_{n=-\infty}^{\infty}x[n]z^{-n}
$$

z 变换将一个序列变换成了复变量 z 的函数，对单位冲击相应 $h[n]$ 作 z 变换：

$$
H(z)=Z\{h[n]\}=\sum_{n=-\infty}^{\infty}h[n]z^{-n}
$$

得到的函数称为系统的**传输函数**。

*单位冲激响应 $h[n]$ 是系统特性在时域的表达，而传输函数 $H (z)$ 则是系统特性在复频域的表达。*

一般情况下，$A(\Omega)=|H(e^{j\Omega})|$ 是系统的幅度 - 频率响应，意为系统对信号归一化角频率 $\Omega$ 分量的增益，当系统归一化角频率单频时，$A (\Omega)$ 即为系统对单频的增益。$P (\Omega)=\angle H(e^{j\Omega})$ 是系统的相位 - 频率响应，意为系统对信号归一化角频率 $\Omega$ 分量的相移，当系统归一化角频率单频时，$P (\Omega)$ 即为输出信和和输入信号的相差。

### 基本元件

![](元件.png)

### 采样定律

序列中两个相邻数值的时间差称为采样周期，其倒数为采样率，单位 Hz。数字信号处理中常用归一化采样率。

### 离散信号的信号比

## 数值运算
### 乘法/除法

变量和变量的乘法运算符选用专用的乘法单元或通用逻辑单元

变量和常量的乘法，常用移位求和。使用 CSD 表示法，用减法代替一部分加法。依据常量的 CSD 表达来进移位加减, 计算变量与常量之积的乘法器称为 CSD 乘法器，CSD 乘法器比直接移位相加在数量上平均节省 1/3 的加法器。对于常量和变量乘法，FPGA 通常会自动调用通用逻辑来实现 CSD 乘法器。也可以通过多周期移位累加来计算。

对于性能要求不高的场合，除法也可以使用多周期。

## 平方根

与笔算类似，平方根可以用多周期实现。

## CORDIC

坐标旋转机（CORDIC）是再直角坐标系中对向量进行旋转变换。将 $(x_0, y_0)$ 逆时针旋转到 $(x_1, y_1)$，

$$
\begin{bmatrix} x_1\\ y_1 \end{bmatrix}=\begin{bmatrix} cos\theta&-sin\theta\\ sin\theta&cos\theta\end{bmatrix}\begin{bmatrix} x_0\\ y_0 \end{bmatrix}=cos\theta\begin{bmatrix} 1&-tan\theta\\ tan\theta&1\end{bmatrix}\begin{bmatrix} x_0\\ y_0 \end{bmatrix}
$$

定义

$$
\begin{bmatrix} x_1'\\ y_1' \end{bmatrix}=\begin{bmatrix} 1&-tan\theta\\ tan\theta&1\end{bmatrix}\begin{bmatrix} x_0\\ y_0 \end{bmatrix}
$$

为伪旋转，它将原始的向量逆时针旋转 $\theta$，长度变为 $1/cos\theta$。

通过 $tan\theta_i=2^{-i}$，实现 $\theta_i=arctan2^{-i}$ 伪旋转将原始的旋转其转换为移位和加减。这样的转换无法实现任意角度，不过由于对所有 $i$ 都有 $2\theta_{i+1}>\theta_i>0$，所以对于 $|\theta|\le\sum_{i=0}^{\infty}\theta_i\approx99.883$，则 $\theta=lim_{k->\infty}\sum_{i=0}^{k}s_i\theta_i, s_i\in\{-1, 1\}$，$\{\theta_i\}$ 收敛于 0。实际中根据精度要求取固定的 $k$ 即可。

## FIR 滤波器

有限冲击响应滤波器，传输函数为：

$$
H(z)=\sum_{k=0}^N h[k]\cdot z^{-k}
$$

其中 $N$ 为阶数，系数共有 $N+1$ 个。滤波器的结构如下，单位延时可用 D 触发器实现，增益为常系数乘法器。

![](FIR滤波器.png)

其中包含一个较长的加法链，这对于硬件实现是不利的。可以通过转置变换得到价结构，这个结构不包含长组合逻辑路径，因而适合时序逻辑实现。

![](转置FIR.png)

FIR 常用来实现线性相位响应的滤波器，线性相位响应的 FIR 滤波器的系数是对称的，即 $h[k]=h[N-k]$，这时所示结构还可以转换成图 7-24 和图 7-25 对称结构，前者为偶数阶的情况，后者为奇数阶的情况。

![](转置FIR对称偶.png)

![](转置FIR对称奇.png)

相应地，如果实现的是线性相位的滤波器，群延迟将为：

$$
\tau_g=（N/2+1）1/f
$$

## IIR 滤波器

无限冲击响应滤波器，传输函数为：

$$
H(z)=\frac{\sum_{i=0}^N n_i\cdot z^{-i}}{1+\sum_{j=0}^D d_j\cdot z^{-j}}
$$

分子共有 $N+1$ 个系数，分母共有 $D$ 个系数 (除 0 次方项系数 1 以外)，其阶数定义为 $D$。

用图 7-30 所示的结构在阶数大于 2 时，可能不稳定，并且阶数越大，有限字长效应导致的累积误差也越大，内部节点增益也可能很发散，所以一般将多阶 IIR 滤波器拆解成多个二阶级联，对于奇数阶，则最后增加一个一阶。

![](IIR转置结构.png)

二阶 IIR 传输函数：

$$
H(z)=\frac{n_0+n_1\cdot z^{-1}+n_2\cdot z^{-2}}{1+d_1\cdot z^{-1}+d_2\cdot z^{-2}}=g\frac{n_0'+n_1'\cdot z^{-1}+n_2'\cdot z^{-2}}{1+d_1\cdot z^{-1}+d_2\cdot z^{-2}}
$$

可以从分子提出系数 g，一般 $|g|<1$，有助于降低有限字长效应。

IIR 则是由多级二阶滤波器构成的多阶滤波器。在 IIR 滤波器结构中，内部节点对输入的幅频响应可能存在大于 0dB 的点，所以在代码中，为数据扩展了位宽 EW 位。

### 定点小数

数字信号处理中要表达的数值多半在 $[-1,1]$ 区间内。在数字域，应尽量让信号的数值范围接近数据位宽能表达的范围，以充分利用应有的量化精度，降低量化误差。

两个定点小数 $a (Qm, n), b (Qp, q)$，加法器的位数应该为 $max\{m, p\} + max\{n, q\}$，应将小数点对齐。乘法器需要的位数为 $max(m+n, p+q)$

## 快速傅里叶变换

$$
X[k] = \mathcal{F}\{x[n]\}=\sum_{n=0}^N x[n]e^{-j2\pi kn/N},N\in Z^+,k\in[0,N)
$$

称为长度为 N 的离散傅里叶变换 DFT，可以看作 z 变换在 $r=1$ 时的变体。离散傅里叶变换将序列 $x[n]$ 变换成另一个序列 $X[k]$，序列 $X[k]$ 是复数序列，表达了 $x[n]$ 中不同归一化角频率 $\Omega=\frac{2\pi k}{N}$ 的成分的幅度和相位信息，称为**频谱**。时域上两个序列的卷积，等效为对它们经过傅里叶变换后得到的频域序列做逐元素的乘积。

以 $N=4$ 为例，可以将上面式子写成矩阵形式：

$$
\begin{pmatrix} X[0] \\ X[1] \\ X[2] \\ X[3]\end{pmatrix} = \begin{pmatrix} w_N^0 & w_N^0 &w_N^0 &w_N^0 \\ w_N^0 & w_N^1 &w_N^2 &w_N^3 \\w_N^0 & w_N^2 &w_N^4 &w_N^6 \\w_N^0 & w_N^3 &w_N^6 &w_N^9 \end{pmatrix}=\begin{pmatrix} x[0] \\ x[1] \\ x[2] \\ x[3]\end{pmatrix}
$$

其中：$w_N=e^{-j 2\pi /N}, w_N^{nk}=cos\frac{2\pi nk}{N}-jsin\frac{2\pi nk}{N}$，矩阵中的每一行的实部和虚部都为不同频率的余弦和负正弦信号，从上而下，归一化角频率为 $2\pi k/N, k\in\mathbb{Z}_N$，因此频谱中的实项为序列与归一化角频率 $\Omega=2\pi k/N$ 的余弦采样序列的逐元素乘积和，虚部为相应的负正弦序列乘积和。

上面的计算，都需要 $N^2$ 次复数乘法和 $N (N-1)$ 次复数加法，复杂度为 $O (N^2)$。**快速傅里叶变换 FFT** 是离散傅里叶变换的改进，利用 $w_N^{nk}$ 的周期性将大规模运算分解为小单元复用。

如果 $N$ 为偶数，将 $X[k]$ 分为奇偶两部分考虑，对于 $m=0,1,\cdots, N/2 -1$

$$
\begin{align}
X[2m]&=\sum_{n=0}^{N/2 - 1}x[n]w_N^{2mn} + \sum_{n=N/2}^{N - 1}x[n]w_N^{2mn}\\
&=\sum_{n=0}^{N/2 - 1}x[n]w_N^{2mn} + \sum_{n=0}^{N/2 - 1}x[n+N/2]w_N^{2m(n+N/2)}\\
&=\sum_{n=0}^{N/2 - 1}(x[n]+x[n+N/2])w_N^{2mn} \\
X[2m+1]&=\sum_{n=0}^{N/2 - 1}(x[n]-x[n+N/2])w_N^nw_N^{2mn} 
\end{align}
$$

可以得知，偶数部分是关于 $x[n]+x[n+N/2]$ 的长度为 $N/2$ 的 DFT。奇数部分是关于 $x[n]+x[n+N/2] w_N^n$ 的长度为 $N/2$ 的 DFT。长度为 $N$ 的 DFT 拆解为长度为 $N/2$ 的 DFT。若 $N$ 为 2 的整数次幂，可以一致拆解到长度为 1 的 DFT，即 $X[0]=x[0]$。

![](奇偶拆解.png)

其中每一次迭代会经历一种蝶形运算单元。

![](蝶形运算单元.png)

注意最后得到的序列并非顺序，而是按角标的二进制位逆序排列，成为按位逆序。

![](基2频率抽选8点FFT.png)

这样在 $X[k]$ 种分奇偶抽选的 FFT 计算方法成为“基 2 频率抽选”，在 $x[n]$ 中分奇偶抽选计算的方法称为“基 2 时间抽选”, 它们都将算法复杂度从复杂度 $O (N^2)$ 降低到了 $O (N log_2N)$。

离散傅里叶变换的逆变换（IDFT）定义为：

$$
x[n] = \mathcal{F}^{-1}\{X[k]\}=\frac1 N \sum_{k=0}^N X[k]e^{j2\pi kn/N},N\in Z^+,n\in[0,N)
$$

将正变换得到的序列还原，与正变换形式上仅有指数正负和系数 $1/N$ 之差。

### 多周期实现

长度为 N 的 FFT/IFFT 算法需要 $log_2 N$ 个拆分步骤，$step \in [0, log_2 N)$，每个步骤将数据分组，每组有 $GrpLen = N/2/2^{sterp}$ 个数据，前后两个组配对参与和或差的积运算，共有 $N/GrpLen$ 组。伪代码：

```c
// 基 2 频率抽选 FFT 算法的伪代码
M = log2(N);
grp = 0;
grpLen = N/2;
for (step = 0; step < M; step++)
  for (grp = 0; grp < N; grp += 2 * grpLen)
    for (i = grp, j = grp + grpLen, k = 0;
      i < grp + grpLen;
      i++, j++, k += 2^step)
      u = x[i] + x[j];
      v = (x[i] - x[j]) * w[k];
      x[i] = u; x[j] = v;
    endfor
  endfor
  grpLen = grpLen / 2;
endfor
```

各循环变量的意义如下：

![](基2频率循环.png)

对于硬件实现：

- 数据的实部和虚部分别用两个 RAM 存储，字深为 N。
- $w_N^k$ 的实部和虚部分别用两个 RAM 存储，并预先初始化好内容，长度 $N/2$。
- 实现 step, grp, i 三层循环控制。
- 在 i 循环的每一次，可能需要多个时钟分别执行读 x[i]、读 x[j]、读 w[k]、计算、写 x[i]、写 x[j] 的操作，若使用单口 RAM，这些操作需要 4 个周期。

## 流水线实现

存储器接口的 FFT 模块适合作为处理器的外设，由处理器或处理器控制下的 DMA 向其提供数据并控制其运作。流水线实现的 FFT 适合用于流式数据处理

# 通信

![](通信收发.png)

## LFSR

https://blog.csdn.net/Loudrs/article/details/130554990?spm=1001.2014.3001.5502

对于通信系统，未知的数字基带码流可以用随机信号来模拟，而在纯粹的数字系统中无法产生严格意义上的随机信号，不过可以产生带宽有限、重复周期很长的“伪随机信号”。伪随机信号可通过线性反馈移位寄存器 (LFSR) 产生，这个结构实际上是原始结构通过转置得到的，适合时序逻辑实现，其中每个寄存器都是 1 位的，1 位的加法可用异或门实现。

![](LFSR.png)

图 8-3 将 `d0` 的输出与 ` d4 d3 d2 ` 异或作为下级延迟的输入。选择 `d0` 的输出反馈到哪些节点会影响输出序列的重复周期，对于上述 8 位 LFSR，合适的反馈点选择会使得输出达到最大周期 $2^8-1$，即除 0 之外的全部可能的 ` d[7:0]` 值都会出现在电路中。

二进制 LFSR 中，选择反馈与哪些输出做异或可以用有限域计算中模 2 的多项式来表示。这个多项式称为特征多项式 (或称反馈多项式)。图 8-3 的特征多项式为: $x^8+x^4+x^3+x^2+1$。对于 N 位 LFSR，能够使得输出序列周期达到 $2^N-1$ 的特征多项式称为本原多项式，此时的 LFSR 称为最长 LFSR。一定位数的 LFSR 的本原多项式数量有限，不同位数的 LFSR 的本原多项式数量不一，比如 7 位 LFSR 有 18 个本原多项式，8 位 LFSR 有 16 个，16 位 LFSR 有 2048 个，32 位 LFSR 有 67108864 个……

对于 N 位的 LFSR，特征多项式中必然有 1 和 xN 项，而其他项则代表着反馈点的位置，请对比图 8-3 进行理解。将 x=2 代入特征多项式，可得到其数值表达，多项式 x8+x4+x3+x2+1 的数值表达 rval=0x11d，所以也常常直接称为“多项式 0x11d”。

## 循环冗余校验 (CRC)

## 基带编解码

## 基带通道
