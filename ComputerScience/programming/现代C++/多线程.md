---
dateCreated: 2025-07-11
dateModified: 2025-07-11
---
# Multithread

Thread

Synchronization utilities

High level abstraction of asynchronous operation



## 并发/并行

- **线程管理（C++11/17）**：
    - `std::thread`, `std::mutex`, `std::lock_guard`。
    - `std::async` 和 `std::future`。
- **原子操作与无锁编程（C++11/17）**：
    - `std::atomic`, `compare_exchange_strong`。
- **协程（C++20）**：
    - 异步 I/O、事件驱动编程的简化。


### 六、多线程与并发（`<thread>`, `<mutex>`, `<future>`）

C++11 引入了标准多线程库，无需依赖平台特定 API（如 Windows 线程、POSIX 线程）：

- **`<thread>`**：`std::thread` 封装线程，支持创建和管理线程。
- **`<mutex>`**：互斥锁（`std::mutex`）、锁守卫（`std::lock_guard`），用于线程同步，避免数据竞争。
- **`<future>` / `<promise>`**：用于线程间通信，获取异步任务的结果。
- **`<atomic>`**：原子操作类型，用于无锁同步（如计数器）。

  

**示例**：多线程同步



```cpp
#include <thread>
#include <mutex>
#include <iostream>

std::mutex mtx;  // 互斥锁
int shared_count = 0;

void increment() {
    std::lock_guard<std::mutex> lock(mtx);  // 自动加锁/解锁
    shared_count++;
}

int main() {
    std::thread t1(increment);
    std::thread t2(increment);
    t1.join();  // 等待线程结束
    t2.join();
    std::cout << shared_count << std::endl;  // 输出 2（无数据竞争）
    return 0;
}
```

# 线程：

> [!note] Thread
> In computer science, a thread of execution is the smallest sequence of programmed instructions that can be managed independently by a scheduler, which is typically a part of the operating system.
> 计算机科学中，线程是操作系统管理的、可以执行编制好的最小单位的指令序列的调度器。





# 问题

## 线程切换开销
假设一个操作系统中,线程上下文切换的开销为4微秒(us)。CPU的时间片长度为8毫秒(ms),如果一个进程中有4个线程
且这些线程在一个时间片内均匀地轮流执行一次,那么线程上下下文切换的总开销占CPU时间的百分比是多少?


本题可先将时间单位统一，再计算出线程上下文切换的总开销以及一个时间片的总时长，最后计算线程上下文切换的总开销占 CPU 时间的百分比。

### 步骤一：统一时间单位

已知1毫秒\(= 1000\)微秒，所以CPU时间片长度8毫秒换算为微秒是：\(8\times1000 = 8000\)微秒。

### 步骤二：计算线程上下文切换的总开销

一个进程中有4个线程，这些线程在一个时间片内均匀地轮流执行一次 ，那么线程上下文切换的次数是\(4 - 1 = 3\)次（因为第一次线程开始执行无需切换，从第一个线程到第二个线程切换1次，第二个到第三个切换1次，第三个到第四个切换1次，共3次切换 ）。 又已知线程上下文切换的开销为4微秒 / 次，所以线程上下文切换的总开销为：\(3\times4 = 12\)微秒。

### 步骤三：计算线程上下文切换的总开销占 CPU 时间的百分比

一个时间片的总时长为8000微秒，根据 “百分比\(=\)（线程上下文切换总开销\(\div\)时间片总时长）\(\times100\%\)”，可得： \(\frac{12}{8000} \times 100\% = 0.15\%\)

  

所以，答案选**A** 。